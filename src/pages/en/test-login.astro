---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Test Login - Ymir Sailing Club" lang="en">
  <main class="max-w-md mx-auto mt-10 p-6">
    <h1 class="text-2xl font-bold mb-6">Test Member Login</h1>
    
    <form id="testForm" class="space-y-4">
      <div>
        <label for="memberNumber" class="block text-sm font-medium mb-2">Member Number</label>
        <input type="text" id="memberNumber" value="1001" class="w-full px-3 py-2 border rounded">
      </div>
      
      <div>
        <label for="pin" class="block text-sm font-medium mb-2">PIN</label>
        <input type="password" id="pin" value="111" class="w-full px-3 py-2 border rounded">
      </div>
      
      <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">
        Test Login
      </button>
    </form>
    
    <div id="results" class="mt-6 p-4 bg-gray-100 rounded hidden">
      <h3 class="font-bold mb-2">Results:</h3>
      <pre id="output" class="text-sm"></pre>
    </div>
  </main>

  <script>
    const form = document.getElementById('testForm');
    const results = document.getElementById('results');
    const output = document.getElementById('output');
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const memberNumber = document.getElementById('memberNumber').value;
      const pin = document.getElementById('pin').value;
      
      output.textContent = 'Testing...\n';
      results.classList.remove('hidden');
      
      try {
        // Test 1: Member Login
        output.textContent += '1. Testing member login...\n';
        const loginResponse = await fetch('/api/member-login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ memberNumber, pin })
        });
        
        const loginData = await loginResponse.json();
        output.textContent += `Login Status: ${loginResponse.status}\n`;
        output.textContent += `Login Response: ${JSON.stringify(loginData, null, 2)}\n\n`;
        
        if (loginData.success) {
          // Test 2: Profile API
          output.textContent += '2. Testing profile API...\n';
          const profileResponse = await fetch(`/api/profile?memberNumber=${memberNumber}`);
          const profileData = await profileResponse.json();
          
          output.textContent += `Profile Status: ${profileResponse.status}\n`;
          output.textContent += `Profile Response: ${JSON.stringify(profileData, null, 2)}\n`;
          
          if (profileData.success) {
            output.textContent += '\n✅ SUCCESS: Both APIs working!\n';
          } else {
            output.textContent += '\n❌ Profile API failed!\n';
          }
        } else {
          output.textContent += '\n❌ Login failed!\n';
        }
        
      } catch (error) {
        output.textContent += `\n❌ Error: ${error.message}\n`;
      }
    });
  </script>
</Layout> 