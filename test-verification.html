<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Verification Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .verification-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .verification-status.hidden {
            display: none;
        }
        .verification-status.verifying {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        .verification-status.verified {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        .verification-status.error {
            background-color: #ffebee;
            color: #c62828;
        }
        .verification-status.required {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        button {
            background-color: #4caf50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .test-results {
            margin-top: 30px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Member Verification Test</h1>
    <p>This page tests the member verification system with fuzzy name matching.</p>
    
    <div class="form-group">
        <label for="memberNumber">Member Number:</label>
        <input type="text" id="memberNumber" placeholder="Enter member number">
    </div>
    
    <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" id="name" placeholder="Enter your name">
    </div>
    
    <div id="verificationStatus" class="verification-status hidden">
        <span class="verification-icon">ðŸ”’</span>
        <span class="verification-text"></span>
    </div>
    
    <button onclick="testVerification()">Test Verification</button>
    
    <div class="test-results">
        <h3>Test Cases:</h3>
        <p><strong>Test 1:</strong> Member number "1" with name "John Doe" (exact match)</p>
        <p><strong>Test 2:</strong> Member number "1" with name "Jon Doe" (1 character difference)</p>
        <p><strong>Test 3:</strong> Member number "1" with name "John Do" (1 character difference)</p>
        <p><strong>Test 4:</strong> Member number "1" with name "Jane Doe" (4 character differences - should fail)</p>
        <p><strong>Test 5:</strong> Member number "999" with name "John Doe" (invalid member number)</p>
    </div>

    <script>
        // Mock API response for testing
        const mockMembers = {
            "1": { name: "John Doe", phone: "123-456-7890" },
            "2": { name: "Jane Smith", phone: "987-654-3210" },
            "3": { name: "Bob Johnson", phone: "555-123-4567" }
        };

        // Levenshtein distance function
        function levenshteinDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        // Verification function
        async function verifyMemberCredentials(memberNumber, enteredName) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 500));
            
            const member = mockMembers[memberNumber];
            
            if (!member) {
                return {
                    valid: false,
                    error: 'Member number not found in database'
                };
            }
            
            const dbName = member.name.toLowerCase().trim();
            const enteredNameLower = enteredName.toLowerCase().trim();
            
            const distance = levenshteinDistance(enteredNameLower, dbName);
            
            if (distance <= 3) {
                return {
                    valid: true,
                    member: member,
                    nameMatch: true
                };
            } else {
                return {
                    valid: false,
                    error: `Name does not match. Expected: ${member.name}, Entered: ${enteredName}`
                };
            }
        }

        // Update verification status display
        function updateVerificationStatus(status, message = '') {
            const statusDiv = document.getElementById('verificationStatus');
            const icon = statusDiv.querySelector('.verification-icon');
            const text = statusDiv.querySelector('.verification-text');
            
            if (status === 'verifying') {
                statusDiv.className = 'verification-status verifying';
                icon.textContent = 'â³';
                text.textContent = 'Verifying member credentials...';
            } else if (status === 'verified') {
                statusDiv.className = 'verification-status verified';
                icon.textContent = 'âœ…';
                text.textContent = 'Member verified successfully';
            } else if (status === 'error') {
                statusDiv.className = 'verification-status error';
                icon.textContent = 'âŒ';
                text.textContent = message || 'Verification failed';
            } else if (status === 'required') {
                statusDiv.className = 'verification-status required';
                icon.textContent = 'ðŸ”’';
                text.textContent = 'Member verification required for checkout';
            } else {
                statusDiv.className = 'verification-status hidden';
            }
        }

        // Test verification function
        async function testVerification() {
            const memberNumber = document.getElementById('memberNumber').value.trim();
            const enteredName = document.getElementById('name').value.trim();
            
            if (!memberNumber) {
                alert('Please enter a member number');
                return;
            }
            
            if (!enteredName) {
                alert('Please enter a name');
                return;
            }
            
            updateVerificationStatus('verifying');
            
            const verification = await verifyMemberCredentials(memberNumber, enteredName);
            
            if (verification.valid) {
                updateVerificationStatus('verified');
                alert(`Verification successful!\nMember: ${verification.member.name}\nPhone: ${verification.member.phone}`);
            } else {
                updateVerificationStatus('error', verification.error);
                alert(`Verification failed: ${verification.error}`);
            }
        }

        // Add real-time verification
        document.getElementById('memberNumber').addEventListener('input', performRealTimeVerification);
        document.getElementById('name').addEventListener('input', performRealTimeVerification);

        let verificationTimeout;
        async function performRealTimeVerification() {
            const memberNumber = document.getElementById('memberNumber').value.trim();
            const enteredName = document.getElementById('name').value.trim();
            
            if (verificationTimeout) {
                clearTimeout(verificationTimeout);
            }
            
            if (!memberNumber) {
                updateVerificationStatus('hidden');
                return;
            }
            
            if (memberNumber && !enteredName) {
                updateVerificationStatus('required');
                return;
            }
            
            verificationTimeout = setTimeout(async () => {
                if (memberNumber && enteredName) {
                    updateVerificationStatus('verifying');
                    
                    const verification = await verifyMemberCredentials(memberNumber, enteredName);
                    
                    if (verification.valid) {
                        updateVerificationStatus('verified');
                    } else {
                        updateVerificationStatus('error', verification.error);
                    }
                }
            }, 500);
        }
    </script>
</body>
</html>
