import{_ as f}from"./profile.astro_astro_type_script_index_0_lang.B_382y5X.js";const a="ymir_current_member",c="ymir_session_expiry",g=1440*60*1e3;async function _(e,n){try{const{verifyMemberCredentials:t,isAdmin:r}=await f(async()=>{const{verifyMemberCredentials:l,isAdmin:m}=await import("./database-postgres.CHZ07N2Y.js");return{verifyMemberCredentials:l,isAdmin:m}},[]),i=await t(e,n);return i?await r(e)?{authorized:!0,member:i}:{authorized:!1,error:"Admin access required"}:{authorized:!1,error:"Invalid member number or PIN"}}catch(t){return console.error("Error checking admin credentials:",t),{authorized:!1,error:"Internal server error"}}}function w(e){const n=Date.now()+g;localStorage.setItem(a,JSON.stringify(e)),localStorage.setItem(c,n.toString()),window.dispatchEvent(new CustomEvent("userLogin",{detail:e}))}function o(){try{const e=localStorage.getItem(a),n=localStorage.getItem(c);return!e||!n?null:Date.now()>parseInt(n)?(u(),null):JSON.parse(e)}catch(e){return console.error("Error getting current user:",e),u(),null}}function u(){localStorage.removeItem(a),localStorage.removeItem(c),window.dispatchEvent(new CustomEvent("userLogout"))}function v(){return o()!==null}function b(){const e=o();return e&&e.is_admin===!0}function h(){const e=o();e&&w(e)}function S(e=null){const n=window.location.pathname+window.location.search,t=e||n,i=window.location.pathname.startsWith("/is")?"/is/profile":"/en/profile";window.location.href=`${i}?returnUrl=${encodeURIComponent(t)}`}function p(e=null){const n=o();return n||(S(e),null)}function A(e=null){const n=p(e);return n?n.is_admin?n:(alert("Admin access required"),window.location.href=e||"/en/",null):null}function d(){const e=o();e?(h(),s(e)):s(null),window.addEventListener("userLogin",n=>{s(n.detail)}),window.addEventListener("userLogout",()=>{s(null)})}function s(e){const n=document.getElementById("badge-messages");n&&(e?y():n.style.display="none"),document.querySelectorAll("[data-auth-required]").forEach(r=>{e?r.classList.remove("hidden"):r.classList.add("hidden")})}async function y(){try{const e=o();if(!e)return;const t=await(await fetch(`/api/messages?action=unreadCount&memberNumber1=${e.member_number}`)).json();if(t.success){const r=document.getElementById("badge-messages");r&&(r.textContent=t.count,r.style.display=t.count>0?"flex":"none")}}catch(e){console.error("Error loading unread count:",e)}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",d):d());export{_ as checkAdminCredentials,u as clearUserSession,h as extendSession,o as getCurrentUser,d as initAuth,b as isAdmin,v as isLoggedIn,S as redirectToLogin,A as requireAdmin,p as requireAuth,w as setUserSession};
